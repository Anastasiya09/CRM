<div class="row">
  <div class="col-md-12 col-sm-12 col-xs-12">
    <table class="table table-striped table-bordered table-condensed table-responsive">
      <thead>
        <tr class="info">
          <th>№</th>
          <th>Name</th>
          <th>Source</th>
          <th>Skype</th>
          <th>Email</th>
          <th>Message</th>
          <th>Links</th>
          <th>Date</th>
          <th>Assign to</th>
          <th>Status</th>
          <th>Comments</th>
        </tr>
      </thead>
      <tbody class="table-responsive">
        <% i=1 %>
        <% @tasks.each do |task| %>
          <tr id=<%="#{task.id}"%>>
            <td class="number">
              <p> <%= i %> </p>
              <% i += 1 %>
            </td>
            <td class='editor' name='name'>
              <div> <%= task.name.html_safe if task.name%> </div>
            </td>
            <td class='editor' name='source'>
              <div> <%= task.source.html_safe if task.source %> </div>
            </td>
            <td class='editor' name='skype'>
              <div> <%= task.skype.html_safe if task.skype %> </div>
            <td class='editor' name='email'>
              <div> <%= task.email.html_safe if task.email %> </div>
            </td>
            <td class="message">
              <div> <%=  %> </div>
            </td>
            <td class='editor links' name='links'>
              <div> <%= task.links.html_safe if task.links %> </div>
            </td>
            <td class="date">
              <input class="date-input" value='<%= task.date  %>'/> 
            </td>
            <td class='user'>
                <%= select("task", "user_id", User.all.collect {|p| [ p.first_name, p.id ] }, { include_blank: "Not assigned", selected: task.user_id }, class: "btn btn-default user", name: 'user_id') %>
            </td>
            <td class='status'>
                <%= select_tag "Status", options_for_select(Task.status.options, task.status), class: "btn btn-default status", name: 'status' %>
            </td>
            <td class='comments'>
              <div class="comment_list"> 
                <% task.comments.order(:created_at).each do |comment| %>
                  <div class="comment <%= comment.id %>">
                    <span class="comment_time"><%= comment.datetime.strftime('%e.%m %H:%M') %></span>
                    <span><%= comment.user.first_name %></span>
                    <% if comment.user == current_user %>
                      <%= link_to image_tag('remove-red.png'), comment, class: 'pull-right', remote: true, 
                        method: :delete  %> 
                    <% end %>
                    <p><%= comment.body %></p>
                  </div>
                <% end %> 
              </div>
            </td>
            <td class="remove"> 
              <%= link_to image_tag('remove.png'), task, data: {
                  confirm: "Are you sure to destroy task №#{i-1}?"
                }, 
                method: :delete %> 
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <%= form_for Task.new do |f| %>
      <%= f.text_field :name, hidden: true %> 
      <%= f.submit "Add new task", class: "btn btn-primary btn-lg pull-right" %>
    <% end %>

    <!-- Hidden blocks for popup dialogs -->
    <div id="dialog" title="Field content editor">
      <textarea class="text_editor"></textarea>
    </div>

    <div id="comments_dialog" >
      <textarea class="comment_body"></textarea>
      <button class="btn btn-primary btn-xs pull-right comment_save", type="button">Add new comment</button>
    </div>   
    <!-- End hidden blocks -->

  </div><!-- /main-content col-md-12 -->
</div> <!-- /row -->
