<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Assigned Meeting</h4>
        <%= form_for(@project, url: projects_path) do |f| %>
        <div class="modal-body">
          <div class="row" id="meeting_dialog">
            <%= f.text_field :name, class: 'form-control', placeholder: 'Title'%>
          </div>
          <div id='invisible'>
            <label>Assing</label>
            <%= hidden_field_tag :user_ids %>
            <ul id='invisible-fields' class='connectedSortable'>
            </ul>
          </div>
          <div id='visible'>
            <label>Not Assing</label>
            <ul id='visible-fields' class='connectedSortable'>
            </ul>
          </div>
          <div class="side-by-side clearfix">
            <%= f.select :kind, JSON.parse(@colors).keys, name: 'user', id: "chosen-kind", class: "chosen-select", placeholder: 'Title'%>
            <div class="circle" id=""></div>
          </div>
        </div>
        <div class="modal-footer">
          <%= f.submit "Create", class: "btn btn-large btn-primary btn-block" %>
        </div>
      <% end %>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $('#myModal').modal();

  var settings;

  (function(){
    $("#project_kind").chosen().change(function(){
    var value = $("#project_kind").val(),
        colors = JSON.parse('<%= raw @colors.html_safe %>'),
        color = colors[value];
    $(".circle").css('backgroundColor', color);
    });
    var path = 'projects/users_for_project';
    $.ajax({
      type: 'GET',
      url: path,
      success: function(data){
        settings = data;
        if(data.visible){
          appendVisibleFields($('#visible-fields'));
        }

        if(data.invisible){
          appendInvisibleFields($('#invisible-fields'));
        }
      }
    });
  })();

  $( "#invisible-fields, #visible-fields" ).sortable({
    connectWith: ".connectedSortable"
  }).disableSelection();

   $(".new_project").submit(function(){
    $("#user_ids").val($('#invisible-fields').listVars());
  });
</script>